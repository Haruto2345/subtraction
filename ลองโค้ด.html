<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡πÄ‡∏Å‡∏°‡∏•‡∏≤‡∏Å‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç: ‡∏ö‡∏ß‡∏Å - ‡∏•‡∏ö ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°</title>
<style>
  :root{
    --bg:#f7fbff; --card:#ffffff; --accent:#2563eb; --good:#16a34a; --bad:#ef4444;
    --coin-size:64px;
  }
  *{box-sizing:border-box; font-family: Inter, system-ui, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial;}
  body{margin:0; padding:20px; background:linear-gradient(180deg,var(--bg),#eef6ff); color:#0f172a;}
  .app{max-width:1100px; margin:0 auto;}
  header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:14px;}
  h1{font-size:20px; margin:0;}
  .controls{display:flex; gap:8px; align-items:center;}
  button{background:var(--card); border:1px solid #e6eefc; padding:8px 12px; border-radius:8px; cursor:pointer; box-shadow:0 1px 0 rgba(2,6,23,0.04);}
  .btn-primary{background:linear-gradient(180deg,var(--accent),#1d4ed8); color:white; border:none;}
  .btn-danger{background:linear-gradient(180deg,var(--bad),#dc2626); color:white; border:none;}
  .toolbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
  .panel{background:var(--card); border-radius:12px; padding:12px; border:1px solid #e9f2ff;}
  .layout{display:grid; grid-template-columns: 360px 1fr; gap:16px;}
  .bank{min-height:160px; padding:10px; position:relative;}
  .bank-title{font-weight:600; margin-bottom:8px;}
  .board{background:linear-gradient(180deg,#ffffff,#f1f8ff); border:2px dashed #cfe6ff; height:520px; border-radius:12px; position:relative; overflow:hidden;}
  .info-row{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;}
  .stat{font-weight:700; font-size:18px;}
  .sub{font-size:13px; color:#334155;}
  .controls small{display:block; color:#475569; font-size:12px;}
  .coin{
    width:var(--coin-size); height:var(--coin-size); border-radius:50%; position:absolute;
    display:flex; align-items:center; justify-content:center; font-weight:800; font-size:18px;
    user-select:none; touch-action:none; cursor:grab; transform-style:preserve-3d;
    transition:transform .45s cubic-bezier(.2,.9,.2,1), box-shadow .12s;
    box-shadow:0 6px 14px rgba(2,6,23,0.08);
  }
  .coin:active{cursor:grabbing;}
  .coin.front{ background:linear-gradient(180deg,#fffacd,#ffd66b); color:#333; border:3px solid #f7d86b;}
  .coin.back{ background:linear-gradient(180deg,#fde8ea,#ff9aa2); color:#46111a; border:3px solid #ffb1b9;}
  .coin.flipped{ transform: rotateY(180deg); }
  .coin .face{ position:absolute; width:100%; height:100%; display:flex; align-items:center; justify-content:center; backface-visibility:hidden; border-radius:50%;}
  .coin .face.back{ transform:rotateY(180deg); }
  .controls .small-muted{font-size:12px; color:#475569;}
  .row{display:flex; gap:8px; align-items:center;}
  .trash{width:48px; height:48px; border-radius:8px; display:flex; align-items:center; justify-content:center; background:#fff; border:1px solid #ffdede;}
  .bottom-actions{display:flex; gap:8px; margin-top:10px; align-items:center;}
  .help{font-size:13px; color:#475569;}
  .hint{font-size:13px; color:#0f172a; margin-top:8px;}
  .floating-hint{position:absolute; right:12px; top:12px; background:rgba(255,255,255,0.9); padding:6px 10px; border-radius:10px; border:1px solid #eef7ff;}
  .mini{font-size:12px; padding:6px 8px;}
  .badge{padding:6px 8px; border-radius:8px; background:#eef8ff; color:#0b72d6; font-weight:700;}
  .legend{display:flex; gap:8px; align-items:center; margin-top:8px;}
  .legend .item{display:flex; gap:6px; align-items:center; font-size:13px;}
  .demo-row{display:flex; gap:8px; align-items:center; margin-top:12px; flex-wrap:wrap;}
  footer{margin-top:12px; font-size:13px; color:#475569;}
</style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>‡πÄ‡∏Å‡∏°‡∏•‡∏≤‡∏Å‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç ‚Äî ‡∏ö‡∏ß‡∏Å / ‡∏•‡∏ö ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏° (‡∏ó‡∏î‡∏•‡∏≠‡∏á)</h1>
      <div class="sub">‡∏•‡∏≤‡∏Å‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏•‡∏á‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô ‡∏Ñ‡∏•‡∏¥‡∏Å/‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡∏•‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏•‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤ +1 ‚Üî ‚àí1 ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏ß‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
    </div>
    <div class="controls">
      <div class="badge" id="totalDisplay">‡∏ú‡∏•‡∏£‡∏ß‡∏°: 0</div>
      <div style="width:8px"></div>
      <button class="btn-primary" id="resetBtn">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
    </div>
  </header>

  <div class="layout">
    <!-- Left: Bank / Controls -->
    <div class="panel">
      <div class="bank">
        <div class="bank-title">‡∏Ñ‡∏•‡∏±‡∏á‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç</div>
        <div class="demo-row">
          <button id="addPlus" class="mini">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç +1</button>
          <button id="addMinus" class="mini">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç ‚àí1</button>
          <button id="addRandom" class="mini">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∏‡∏î‡∏™‡∏∏‡πà‡∏° (5)</button>
        </div>
        <div class="hint">‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡∏•‡∏≤‡∏Å‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô ‡∏ó‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤ ‚Äî ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥‡∏ã‡πâ‡∏≥ ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≤‡∏Å‡πÑ‡∏õ‡∏ß‡∏≤‡∏á</div>

        <div style="margin-top:10px;">
          <div class="legend">
            <div class="item"><div style="width:22px;height:22px;border-radius:50%;background:linear-gradient(180deg,#fffacd,#ffd66b);border:2px solid #f7d86b"></div> <span>‡∏Ñ‡πà‡∏≤ +1 (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏•‡∏¥‡∏Å‡πÄ‡∏õ‡πá‡∏ô ‚àí1)</span></div>
            <div class="item"><div style="width:22px;height:22px;border-radius:50%;background:linear-gradient(180deg,#fde8ea,#ff9aa2);border:2px solid #ffb1b9"></div> <span>‡∏Ñ‡πà‡∏≤ ‚àí1 (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏•‡∏¥‡∏Å‡πÄ‡∏õ‡πá‡∏ô +1)</span></div>
          </div>
        </div>

        <div style="margin-top:12px;" class="sub">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div>
        <div class="demo-row">
          <button id="flipAll" class="mini">‡∏û‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          <button id="countOnBoard" class="mini">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
          <button id="removeAll" class="mini">‡∏•‡∏ö‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>

        <div class="hint" style="margin-top:10px">‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Ñ‡∏£‡∏π: ‡∏Å‡∏î <strong>Share ‚Üí Make a copy for each student</strong> ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πá‡∏Å‡∏ó‡∏≥‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</div>
      </div>
    </div>

    <!-- Right: Board -->
    <div>
      <div class="panel" style="padding:12px 12px 8px 12px;">
        <div class="info-row">
          <div>
            <div class="sub">‡πÇ‡∏à‡∏ó‡∏¢‡πå (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</div>
            <div style="margin-top:6px; font-weight:700; font-size:18px;">‡πÇ‡∏à‡∏ó‡∏¢‡πå: <span id="problemText">‚àí2 + 5 = ?</span></div>
          </div>
          <div style="text-align:right">
            <div class="sub">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</div>
            <div style="margin-top:6px;">‡∏•‡∏≤‡∏Å‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏ú‡∏•‡∏£‡∏ß‡∏°</div>
          </div>
        </div>

        <div style="margin-top:10px; display:flex; gap:12px; align-items:center;">
          <div style="flex:1;">
            <div class="board" id="board">
              <div class="floating-hint" id="boardCount">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô: 0</div>
              <!-- coins will be appended here -->
            </div>
          </div>
          <div style="width:240px;">
            <div class="panel" style="padding:10px;">
              <div style="font-weight:700">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</div>
              <div style="margin-top:8px;">
                <div class="stat" id="sumValue">0</div>
                <div class="sub">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</div>
              </div>

              <div style="margin-top:12px;">
                <div class="row">
                  <label>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô: </label>
                  <input type="text" id="problemInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô -2 + 5" style="flex:1; padding:6px; border-radius:6px; border:1px solid #e6eefc;">
                </div>
                <div style="margin-top:8px;" class="row">
                  <button id="applyProblem" class="mini">‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå</button>
                  <button id="autoSolve" class="mini">‡πÄ‡∏â‡∏•‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</button>
                </div>
                <div class="help" style="margin-top:8px">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏â‡∏•‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏ô‡∏¥‡∏û‡∏à‡∏ô‡πå</div>
              </div>

              <div style="margin-top:12px;">
                <div style="font-weight:700">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏¥‡πâ‡∏á</div>
                <div style="margin-top:8px; display:flex; gap:8px;">
                  <div id="trash" class="trash">üóëÔ∏è</div>
                  <div class="sub">‡∏•‡∏≤‡∏Å‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏°‡∏≤‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å</div>
                </div>
              </div>

              <div class="bottom-actions">
                <button id="explain" class="mini">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</button>
                <button id="downloadBtn" class="mini">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô PNG</button>
              </div>
            </div>
          </div>
        </div>

      </div>

      <footer>‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç ‚Üí ‡∏•‡∏≤‡∏Å‡∏•‡∏á‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô ‚Üí ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏•‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤ (+ ‚Üî ‚àí) ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏ß‡∏°‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</footer>
    </div>
  </div>
</div>

<script>
/* Simple interactive drag + flip coin playground
   - coins are absolute elements inside document.body
   - on pointerdown we track pointer movements to "drag" the coin element
   - coin has data-value: "1" or "-1"; class 'flipped' indicates rotated state (flip animation)
   - sum computed by checking coins inside board bounds
*/

// helpers
const q = s => document.querySelector(s);
const qa = s => Array.from(document.querySelectorAll(s));

const board = q('#board');
const totalDisplay = q('#totalDisplay');
const sumValue = q('#sumValue');
const boardCount = q('#boardCount');
const problemText = q('#problemText');
const problemInput = q('#problemInput');

let coinIdCounter = 0;

// create a coin DOM
function makeCoin(value=1, x=20, y=20){
  const coin = document.createElement('div');
  coin.className = 'coin';
  coin.style.left = x + 'px';
  coin.style.top = y + 'px';
  coin.dataset.value = value; // numeric 1 or -1
  coin.dataset.id = 'c' + (++coinIdCounter);
  coin.innerHTML = `
    <div class="face front">${value>0?'':''}</div>
    <div class="face back">${value>0?'':''}</div>
  `;
  // assign style based on sign (front/back color)
  if(value>0){
    coin.classList.add('front');
  } else {
    coin.classList.add('back', 'flipped'); // show back when negative to make visual sense
  }

  // show on board by default (position relative to board)
  // place at top-left of board area if inside board
  const br = board.getBoundingClientRect();
  // place relative to board coordinates
  coin.style.left = (br.left + 20 + ((coinIdCounter*10) % (br.width-100))) + 'px';
  coin.style.top = (br.top + 20 + ((coinIdCounter*6) % (br.height-120))) + 'px';
  // append to body so we can absolutely position it over board
  document.body.appendChild(coin);

  // pointer-based drag
  coin.addEventListener('pointerdown', startDrag);
  // click to flip (single click) and double click also flip
  coin.addEventListener('click', (e) => {
    // prevent click after dragging
    if(coin.dataset.dragging === '1') { coin.dataset.dragging = '0'; return; }
    toggleFlip(coin);
  });
  coin.addEventListener('dblclick', (e) => {
    toggleFlip(coin);
  });

  // right-click to remove quickly
  coin.addEventListener('contextmenu', (e)=>{
    e.preventDefault();
    coin.remove();
    computeSum();
  });

  return coin;
}

function toggleFlip(coin){
  // flip visual
  coin.classList.toggle('flipped');
  // toggle numeric value shown in dataset
  const current = Number(coin.dataset.value);
  coin.dataset.value = String(-current);
  // update face text (front/back)
  const faces = coin.querySelectorAll('.face');
  faces[0].textContent = coin.dataset.value === '1' ? '' : '';
  faces[1].textContent = coin.dataset.value === '1' ? '' : '';
  // color swap
  if(Number(coin.dataset.value) > 0){
    coin.classList.add('front');
    coin.classList.remove('back');
  } else {
    coin.classList.remove('front');
    coin.classList.add('back');
  }
  computeSum();
}

// dragging mechanics using pointer events
let currentDrag = null;
function startDrag(e){
  e.preventDefault();
  const coin = e.currentTarget;
  coin.setPointerCapture(e.pointerId);
  coin.dataset.dragging = '1';
  currentDrag = { coin, startX: e.clientX, startY: e.clientY,
                  origLeft: parseFloat(coin.style.left||0),
                  origTop: parseFloat(coin.style.top||0),
                  pointerId: e.pointerId
                };

  coin.style.transition = 'none';
  coin.style.zIndex = 9999;
  // small scale up
  coin.style.transform = (coin.classList.contains('flipped') ? 'rotateY(180deg) scale(1.06)' : 'scale(1.06)');
  window.addEventListener('pointermove', doDrag);
  window.addEventListener('pointerup', endDrag);
}

function doDrag(e){
  if(!currentDrag) return;
  if(e.pointerId !== currentDrag.pointerId) return;
  const dx = e.clientX - currentDrag.startX;
  const dy = e.clientY - currentDrag.startY;
  const nx = currentDrag.origLeft + dx;
  const ny = currentDrag.origTop + dy;
  currentDrag.coin.style.left = nx + 'px';
  currentDrag.coin.style.top = ny + 'px';
}

function endDrag(e){
  if(!currentDrag) return;
  const coin = currentDrag.coin;
  coin.releasePointerCapture(currentDrag.pointerId);
  coin.style.transition = '';
  coin.style.zIndex = '';
  coin.style.transform = coin.classList.contains('flipped') ? 'rotateY(180deg)' : '';
  // if dropped over trash, remove
  const trash = q('#trash').getBoundingClientRect();
  const cRect = coin.getBoundingClientRect();
  if(rectOverlap(trash, cRect)){
    coin.remove();
    currentDrag = null;
    computeSum();
    window.removeEventListener('pointermove', doDrag);
    window.removeEventListener('pointerup', endDrag);
    return;
  }
  // else ensure coin stays within viewport (optional)
  // compute sum if coin is inside board bounds
  currentDrag = null;
  computeSum();
  window.removeEventListener('pointermove', doDrag);
  window.removeEventListener('pointerup', endDrag);
}

function rectOverlap(a,b){
  return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
}

// compute sum of coins whose center lies inside board bounds
function computeSum(){
  const coins = qa('.coin');
  const br = board.getBoundingClientRect();
  let sum = 0;
  let count = 0;
  coins.forEach(c => {
    const r = c.getBoundingClientRect();
    const cx = r.left + r.width/2;
    const cy = r.top + r.height/2;
    if(cx >= br.left && cx <= br.right && cy >= br.top && cy <= br.bottom){
      sum += Number(c.dataset.value || 0);
      count++;
    }
  });
  totalDisplay.textContent = '‡∏ú‡∏•‡∏£‡∏ß‡∏°: ' + sum;
  sumValue.textContent = sum;
  boardCount.textContent = '‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô: ' + count;
  return {sum, count};
}

// UI button bindings
q('#addPlus').addEventListener('click', ()=> makeCoin(1));
q('#addMinus').addEventListener('click', ()=> makeCoin(-1));
q('#addRandom').addEventListener('click', ()=>{
  for(let i=0;i<5;i++){
    makeCoin(Math.random()>0.5?1:-1);
  }
});
q('#resetBtn').addEventListener('click', ()=>{
  qa('.coin').forEach(c=>c.remove());
  computeSum();
});
q('#flipAll').addEventListener('click', ()=>{
  qa('.coin').forEach(c=> toggleFlip(c));
});
q('#removeAll').addEventListener('click', ()=>{
  qa('.coin').forEach(c=>c.remove());
  computeSum();
});
q('#countOnBoard').addEventListener('click', computeSum);

q('#applyProblem').addEventListener('click', ()=>{
  const txt = problemInput.value.trim();
  if(!txt){ alert('‡πÉ‡∏™‡πà‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÄ‡∏ä‡πà‡∏ô: -2 + 5'); return; }
  problemText.textContent = txt;
});
q('#autoSolve').addEventListener('click', ()=>{
  const txt = (problemInput.value||problemText.textContent).trim();
  try{
    // safely evaluate simple arithmetic with only digits, parentheses, + - * / and spaces
    if(!/^[0-9\s()+\-/*]+$/.test(txt.replace(/‚àí/g,'-'))){ throw 'invalid'; }
    const expr = txt.replace(/‚àí/g,'-');
    // eslint-disable-next-line no-eval
    const ans = eval(expr);
    alert('‡πÄ‡∏â‡∏•‡∏¢: ' + ans);
  }catch(e){
    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ô‡∏¥‡∏û‡∏à‡∏ô‡πå‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ä‡πà‡∏ô -2 + 5');
  }
});

q('#explain').addEventListener('click', ()=>{
  alert('‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô:\n\n1) ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πá‡∏Å‡∏•‡∏≤‡∏Å‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç -2 ‡∏°‡∏≤‡∏ß‡∏≤‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° +1 ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå\n2) ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πá‡∏Å‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏û‡∏•‡∏¥‡∏Å‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£\n3) ‡∏ï‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏ö‡∏ß‡∏Å‡πÅ‡∏•‡∏∞‡∏•‡∏ö (‡πÄ‡∏ä‡πà‡∏ô 3 + (-4)) ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πá‡∏Å‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏¥‡∏î\n\n(‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß)');
});

// download board as PNG (simple)
q('#downloadBtn').addEventListener('click', ()=>{
  // use html2canvas if available; fallback to take screenshot of board via browser's Print? We will use toDataURL via SVG serializer for simple capture of board background and coin positions.
  // For simplicity we create a SVG snapshot of the board and coin circles.
  const br = board.getBoundingClientRect();
  const coins = qa('.coin');
  const svgNS = 'http://www.w3.org/2000/svg';
  const svg = document.createElementNS(svgNS,'svg');
  svg.setAttribute('width', br.width);
  svg.setAttribute('height', br.height);
  svg.setAttribute('xmlns','http://www.w3.org/2000/svg');
  // background
  const rect = document.createElementNS(svgNS,'rect');
  rect.setAttribute('width','100%');
  rect.setAttribute('height','100%');
  rect.setAttribute('fill','#ffffff');
  svg.appendChild(rect);
  coins.forEach(c=>{
    const r = c.getBoundingClientRect();
    const cx = r.left - br.left + r.width/2;
    const cy = r.top - br.top + r.height/2;
    const val = Number(c.dataset.value);
    const circle = document.createElementNS(svgNS,'circle');
    circle.setAttribute('cx', cx);
    circle.setAttribute('cy', cy);
    circle.setAttribute('r', Math.min(r.width,r.height)/2 - 4);
    circle.setAttribute('fill', val>0 ? '#fff6b8' : '#ffe0e5');
    circle.setAttribute('stroke', val>0 ? '#f7d86b' : '#ffb1b9');
    svg.appendChild(circle);
    const txt = document.createElementNS(svgNS,'text');
    txt.setAttribute('x', cx);
    txt.setAttribute('y', cy + 6);
    txt.setAttribute('text-anchor','middle');
    txt.setAttribute('font-size','20');
    txt.setAttribute('font-family','Arial');
    txt.setAttribute('fill','#111');
    txt.textContent = val>0 ? '' : '-1';
    svg.appendChild(txt);
  });
  const svgData = new XMLSerializer().serializeToString(svg);
  const img = new Image();
  const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
  const url = URL.createObjectURL(svgBlob);
  img.onload = ()=>{
    const canvas = document.createElement('canvas');
    canvas.width = br.width * 2;
    canvas.height = br.height * 2;
    const ctx = canvas.getContext('2d');
    ctx.scale(2,2);
    ctx.drawImage(img,0,0);
    URL.revokeObjectURL(url);
    const dataURL = canvas.toDataURL('image/png');
    const a = document.createElement('a');
    a.href = dataURL;
    a.download = 'board.png';
    a.click();
  };
  img.src = url;
});

// initial seed
for(let i=0;i<3;i++){ makeCoin(1); makeCoin(-1); }
computeSum();

// recompute periodically in case coins are moved by other users in shared doc
setInterval(computeSum, 700);

</script>
</body>
</html> 